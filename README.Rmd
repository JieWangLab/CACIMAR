---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# CACIMAR

<!-- badges: start -->
<!-- badges: end -->

CACIMAR is an R package to identify cross-species marker genes, cell types and gene regulatory networks based on scRNA-seq data.

## Installation

Install CACIMAR from github, run:

``` r
# install.packages("devtools")
devtools::install_github("jiang-junyao/CACIMAR")
```
## Inputs data
### (1) Seurat object
Seurat object should have clustering information in active.ident slot and meta.data slot

### (2) Marker genes table (used for identifying cell types)
Rownames of Marker genes table should be the same format as the rownames format of seurat object, and should contain CellType column (Marker genes table can also contain other columns, which will not affect this function)

## Tutorial

### 1.Identify Cell types
Using known marker genes to annotate each cluster. This method is based on AUC (area under the receiver operating characteristic curve of gene expression), and is very sensitive to the marker genes input.

```{r warning=F,message=F}
library(CACIMAR)
Marker<-read.table('D:\\GIBH\\platform\\test data/Retinal_markersZf.txt',header = T)
head(Marker)
```
```r
### I identify cell type for 3 clusters here to reduce the running time
seurat_object<-readRDS('D:\\GIBH\\platform\\test data/Zebrafishdata.rds')
seurat_object<-subset(seurat_object,idents = c(1,2,3))
zfcelltype<-Identify_CellType(seurat_object,Marker)
```

### 2.Identify markers
In this part, CACIMAR first uses ROC analysis in 'FindAllMarkers' function of [Seurat](https://satijalab.org/seurat/articles/get_started.html) to identify marker genes in each cluster. Then, based on marker genes identified above, CACIMAR calculates the power of marker gene in each and differences of marker gene between clusters, and marker genes with high differences between clusters will be retained. Finally, CACIMAR uses fisher test to identify significant cluster related to this marker gene (p.value <0.05).
```r
Marker1<-Identify_Markers(seurat_object,Spec1='Zf')
```

### 3.Identify cross-species marker genes
CACIMAR uses
```r
###usage???
###Get_Wilcox_Markers_Cond ###???usage???
wilcox<-read.table('D:\\GIBH\\platform\\test data/mmP60RmmNMDA_mmP60mmLD_wilcoxMG_MarkerGenes.txt')
Cor<-read.table('D:\\GIBH\\platform\\test data/mmP60RmmNMDA_mmLD_pbmcSubC_MG_Bin50_R5_GeneCor.txt',header = T)
wilcox_result<-get_Wilcox_Markers_Cond(wilcox,Cor)
###Overlap_Markers_Cond
mmMarkers3_F3F0 <- read.delim("D:/GIBH/platform/test data/mmP60RmmNMDA_mmP60mmLD_P03_Markers3_F3F0.txt")
zfMarkers3_F3F0 <- read.delim("D:/GIBH/platform/test data/zfAdzfNMDA_zfAdzfLD_zfAdzfTR_P03_Markers3_F3F0.txt")
mmCelltype<-read.table('D:/GIBH/platform/test data/mmP60RmmNMDA_mmP60mmLD_Cell_Types.txt',header = T)
zfCelltype<-read.table('D:/GIBH/platform/test data/zfAdzfNMDA_zfAdzfLD_zfAdzfTR_Cell_Types.txt',header = T)
mmMarker<-Overlap_Markers_Cond(mmMarkers3_F3F0,mmCelltype,Spec1='mm')
zfMarker<-Overlap_Markers_Cond(zfMarkers3_F3F0,zfCelltype,Spec1='zf')
```
#### Identify cross-species marker genes in two species 
```r
###Get_Used_OrthG
rownames(mmMarker)<-mmMarkers3_F3F0[,1]
rownames(zfMarker)<-zfMarkers3_F3F0[,1]
OrthG<-read.delim('D:/GIBH/platform/test data/RNA_genes_mmVSzf.txt')
ShMarker<-Get_Used_OrthG(OrthG,mmMarker,zfMarker,Species = c('mm','zf'))
refined_markers<-Refine_TwoSpecies(ShMarker,mmCelltype,zfCelltype,Species = c('mm','zf'))
```

### 4.plot MarkersHeaptmap
```r
Marker1_plot<-Format_Markers_Frac(Marker1)
plot_MarkersHeatmap(Marker1_plot)
```


### 5.Cross-species celltype heamtmap
```r
expression<-read.table('D:\\GIBH\\platform\\CellType_Comp\\CellType_Comp\\Data/mmP60RmmNMDA_chP10chNMDA_zfAdzfNMDA_Power01_SharedMarkers_Frac.txt')
celltypes<-read.delim("D:/GIBH/platform/CellType_Comp/CellType_Comp/Data/mmP60RmmNMDA_chP10chNMDA_zfAdzfNMDA_Cell_Types.txt")
a<-Heatmap_Cor(expression,celltypes,cluster_cols=T, cluster_rows=F)
Plot_tree(a)
```

###6. Cross-species regulatory networks
